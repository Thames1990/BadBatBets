{% extends 'the_platform/base.html' %}

{% block title %}
    {{ user.profile }} | {{ block.super }}
{% endblock %}

{% block links %}
    <ul>
        <li>
            <a href="{% url 'profiles:feedback' %}">Feedback</a>
        </li>
        <li>
            <a>Create Bet</a>
            <menu>
                <menuitem>
                    <a href="{% url 'bets:create_choice_bet' %}">Choice Bet</a>
                </menuitem>
                <menuitem>
                    <a href="{% url 'bets:create_date_bet' %}">Date Bet</a>
                </menuitem>
            </menu>
        </li>
        <li>
            <a>{{ user.profile }}</a>
            <menu>
                <menuitem>
                    <a href="{% url 'profiles:profile' %}">Profile</a>
                </menuitem>
                <menuitem>
                    <a href="{% url 'profiles:logout' %}">Logout</a>
                </menuitem>
            </menu>
        </li>
    </ul>
{% endblock %}

{% block content %}
    <table>
        <tr>
            <th>Username</th>
            <td>{{ user.username }}</td>
        </tr>
        <tr>
            <th>Account Balance</th>
            <td>{{ user.profile.account.balance }}</td>
        </tr>
    </table>
    <hr>

    {% if user.is_superuser %}
        <h2>Feedback</h2>
        <table>
            <tr>
                <th>User</th>
                <th>Message</th>
                <th>Resolved</th>
            </tr>
            {% for feedback in request.user.feedback_set.all %}
                <tr>
                    <td>{{ feedback.provided_by }}</td>
                    <td style="white-space: pre">{{ feedback.feedback }}</td>
                    {% if feedback.resolved %}
                        <td>True</td>
                    {% else %}
                        <td>
                            <form action="{% url 'profiles:resolve_feedback' feedback.id %}" method="post">
                                {% csrf_token %}
                                <button
                                    name="{{ feedback.prim_key }}"
                                    onclick="return confirm('Are you sure? The feedback will be resolved.')"
                                >
                                    Resolve
                                </button>
                            </form>
                        </td>
                    {% endif %}
                </tr>
            {% empty %}
            {% endfor %}
        </table>
    {% endif %}
    <hr>
    <grid>
        <div col="1/2" class="border_right">
            <h2>Credit</h2>
            {% if user.profile.account.credit_set.all %}
                <table>
                    <tr>
                        <th>Transaction</th>
                        <th>Amount</th>
                    </tr>
                    {% for credit in user.profile.account.credit_set.all %}
                        <tr>
                            <td style="white-space: pre">{{ credit.transaction.description }}</td>
                            <td>{{ credit.amount }}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                <h5 style="text-align: center">There are no credits yet.</h5>
            {% endif %}
        </div>
        <div col="1/2" class="border_left">
            <h2>Debit</h2>
            {% if user.profile.account.debit_set.all %}
                <table>
                    <tr>
                        <th>Transaction</th>
                        <th>Amount</th>
                    </tr>
                    {% for debit in user.profile.account.debit_set.all %}
                        <tr>
                            <td style="white-space: pre">{{ debit.transaction.description }}</td>
                            <td>{{ debit.amount }}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                <h5 style="text-align: center">There are no debits yet.</h5>
            {% endif %}
        </div>
    </grid>
    <hr>
    <grid>
        <div col="1/2" class="border_right">
            <h2>Resolved Choice Bets</h2>
            {% for resolved_bet in resolved_placed_choice_bets %}
                <a class="card_link" href="{% url 'bets:bet' resolved_bet.placed_on.prim_key %}">
                    <card>
                        <h5>{{ resolved_bet.placed_on.name }}</h5>
                        <hr>
                        <p>{{ resolved_bet.placed_on.description }}</p>
                    </card>
                </a>
            {% empty %}
                <h5 style="text-align: center">There are not resolved choice bets yet.</h5>
            {% endfor %}
        </div>
        <div col="1/2" class="border_left">
            <h2>Resolved Date Bets</h2>
            {% for resolved_bet in resolved_placed_date_bets %}
                <a class="card_link" href="{% url 'bets:bet' resolved_bet.placed_on.prim_key %}">
                    <card>
                        <h5>{{ resolved_bet.placed_on.name }}</h5>
                        <hr>
                        <p>{{ resolved_bet.placed_on.description }}</p>
                    </card>
                </a>
            {% empty %}
                <h5 style="text-align: center">There are no resolved date bets yet.</h5>
            {% endfor %}
        </div>
    </grid>
{% endblock %}
