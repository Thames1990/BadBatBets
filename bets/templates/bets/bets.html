{% extends 'the_platform/base.html' %}

{% block title %}
    {% if choice_bet %}
        {{ choice_bet }} | {{ block.super }}
    {% elif date_bet %}
        {{ date_bet }} | {{ block.super }}
    {% endif %}
{% endblock %}

{% block links %}
    <ul>
        <li>
            <a href="{% url 'profiles:feedback' %}">Feedback</a>
        </li>
        <li>
            <a>Create Bet</a>
            <menu>
                <menuitem>
                    <a href="{% url 'bets:create_choice_bet' %}">Choice Bet</a>
                </menuitem>
                <menuitem>
                    <a href="{% url 'bets:create_date_bet' %}">Date Bet</a>
                </menuitem>
            </menu>
        </li>
        <li>
            <a>{{ user.profile }}</a>
            <menu>
                <menuitem>
                    <a href="{% url 'profiles:profile' %}">Profile</a>
                </menuitem>
                <menuitem>
                    <a href="{% url 'profiles:logout' %}">Logout</a>
                </menuitem>
            </menu>
        </li>
    </ul>
{% endblock %}

{% block content %}
    {% if choice_bet %}
        <h1>{{ choice_bet.name }}</h1>
        <table>
            <tr>
                <th>Owner</th>
                <td>{{ choice_bet.owner }}</td>
            </tr>
            <tr>
                <th>Description</th>
                <td>{{ choice_bet.description }}</td>
            </tr>
            {% if placed_bet %}
                <tr>
                    <th>Your Choice</th>
                    <td>{{ placed_bet.chosen }}</td>
                </tr>
                <tr>
                    <th>Points placed</th>
                    <td>{{ placed_bet.placed }}</td>
                </tr>
                <tr>
                    <th>Choice picks</th>
                    <td>{{ placed_bet.chosen.picks }}</td>
                </tr>
            {% endif %}
            {% if not choice_bet.resolved %}
                {% if choice_bet.ends_date %}
                    <tr>
                        <th>Ends on</th>
                        <td>{{ choice_bet.end_date }}</td>
                    </tr>
                {% endif %}
            {% else %}
                <tr>
                    <th>Winning choice</th>
                    <td>{{ choice_bet.winning_choice }}</td>
                </tr>
                <tr>
                    <th>Pot</th>
                    <td>{{ pot_size }}</td>
                </tr>
            {% endif %}
        </table>
        <hr>

        {% if user_can_place_bet and choice_bet.owner == user.profile and not choice_bet.winning_choice %}
            <grid>
                <div col="1/2" class="border_right">
                    <h2>Place Bet</h2>
                    <form action="{% url 'bets:place_bet' choice_bet.prim_key %}" method="post">
                        {% csrf_token %}
                        <label for="number"><h5>Amount</h5></label>
                        <input
                            type="number"
                            id="placed"
                            name="placed"
                            min="0"
                            placeholder="Amount"
                            required
                        >
                        <h5>Available choices</h5>
                        {% for choice in choice_bet.choice_set.all %}
                            <input
                                type="radio"
                                id="{{ forloop.counter }}"
                                name="choice"
                                value="{{ choice.description }}"
                                required
                            >
                            <label for="{{ forloop.counter }}">{{ choice.description }}</label>
                            <br>
                        {% empty %}
                            <p style="display: inline">
                                No choices available. Please contact the administrator. This shouldn't happen.
                            </p>
                        {% endfor %}
                        <hr>
                        <button m-full type="submit">Bet</button>
                    </form>
                </div>
                <div col="1/2" class="border_left">
                    <h2>Resolve Bet</h2>
                    <form action="{% url 'bets:resolve_bet' choice_bet.prim_key %}" method="post">
                        {% csrf_token %}
                        <h5>Available Choices</h5>
                        {% for choice in choice_bet.choice_set.all %}
                            <input
                                type="radio"
                                id="{{ forloop.counter }}"
                                name="choice"
                                value="{{ choice }}"
                            >
                            <label for="{{ forloop.counter }}">{{ choice }}</label>
                            <br>
                        {% empty %}
                            <p style="display: inline">
                                No choices available. Please contact the administrator. This shouldn't happen.
                            </p>
                        {% endfor %}
                        <hr>
                        <button
                            m-full
                            name="resolve"
                            value="resolve"
                            onclick="return confirm('Are you sure? The bet will be closed and the pot will be distributed.')"
                        >
                            Resolve
                        </button>
                    </form>
                </div>
            </grid>
        {% elif user_can_place_bet and choice_bet.owner != user.profile and not choice_bet.winning_choice %}
            <h2>Place Bet</h2>
            <form action="{% url 'bets:place_bet' choice_bet.prim_key %}" method="post">
                {% csrf_token %}
                <label for="number"><h5>Amount</h5></label>
                <input
                    type="number"
                    id="placed"
                    name="placed"
                    min="0"
                    placeholder="Amount"
                    required
                >
                <h5>Available choices</h5>
                {% for choice in choice_bet.choice_set.all %}
                    <input
                        type="radio"
                        id="{{ forloop.counter }}"
                        name="choice"
                        value="{{ choice.description }}"
                        required
                    >
                    <label for="{{ forloop.counter }}">{{ choice.description }}</label>
                    <br>
                {% empty %}
                    <p style="display: inline">
                        No choices available. Please contact the administrator. This shouldn't happen.
                    </p>
                {% endfor %}
                <hr>
                <button m-full type="submit">Bet</button>
            </form>
        {% elif not user_can_place_bet and choice_bet.owner == user.profile and choice_bet.winning_choice == None %}
            <h2>Resolve Bet</h2>
            <form action="{% url 'bets:resolve_bet' choice_bet.prim_key %}" method="post">
                {% csrf_token %}
                <h5>Available Choices</h5>
                {% for choice in choice_bet.choice_set.all %}
                    <input
                        type="radio"
                        id="{{ forloop.counter }}"
                        name="choice"
                        value="{{ choice }}"
                    >
                    <label for="{{ forloop.counter }}">{{ choice }}</label>
                    <br>
                {% empty %}
                    <p style="display: inline">
                        No choices available. Please contact the administrator. This shouldn't happen.
                    </p>
                {% endfor %}
                <hr>
                <button
                    m-full
                    name="resolve"
                    value="resolve"
                    onclick="return confirm('Are you sure? The bet will be closed and the pot will be distributed.')"
                >
                    Resolve
                </button>
            </form>
        {% endif %}
    {% elif date_bet %}
        <h1>{{ date_bet.name }}</h1>
        <table>
            <tr>
                <th>Owner</th>
                <td>{{ date_bet.owner }}</td>
            </tr>
            <tr>
                <th>Description</th>
                <td>{{ date_bet.description }}</td>
            </tr>
            {% if placed_bet %}
                <tr>
                    <th>Your Choice</th>
                    <td>{{ placed_bet.placed_date }}</td>
                </tr>
                <tr>
                    <th>Points placed</th>
                    <td>{{ placed_bet.placed }}</td>
                </tr>
            {% endif %}
            {% if not date_bet.resolved %}
                {% if date_bet.time_period_start %}
                    <tr>
                        <th>Period starts on</th>
                        <td>{{ date_bet.time_period_start }}</td>
                    </tr>
                {% endif %}
                {% if date_bet.time_period_end %}
                    <tr>
                        <th>Period ends on</th>
                        <td>{{ date_bet.time_period_end }}</td>
                    </tr>
                {% endif %}
            {% else %}
                <tr>
                    <th>Winning Date</th>
                    <td>{{ date_bet.winning_date }}</td>
                </tr>
                <tr>
                    <th>Pot</th>
                    <td>{{ pot_size }}</td>
                </tr>
            {% endif %}
        </table>

        {% if user_can_place_bet and date_bet.owner == user.profile and not date_bet.winning_date %}
            <grid>
                <div col="1/2" class="border_right">
                    <h2>Place Bet</h2>
                    <form action="{% url 'bets:place_bet' date_bet.prim_key %}" method="post">
                        {% csrf_token %}
                        <label for="number"><h5>Amount</h5></label>
                        <input
                            type="number"
                            id="placed"
                            name="placed"
                            min="0"
                            placeholder="Amount"
                            required
                        >
                        <label for="date"><h5>Date</h5></label>
                        <input
                            type="date"
                            id="placed"
                            name="date"
                            min="{{ date_bet.time_period_start|date:"Y-m-d" }}"
                            max="{{ date_bet.time_period_end|date:"Y-m-d" }}"
                            placeholder="Date"
                            required
                        >
                        <button m-full type="submit">Bet</button>
                    </form>
                </div>
                <div col="1/2" class="border_left">
                    <h2>Resolve Bet</h2>
                    <h5>Winning Date</h5>
                    <form action="{% url 'bets:resolve_bet' date_bet.prim_key %}" method="post">
                        {% csrf_token %}
                        <input
                            type="date"
                            id="{{ forloop.counter }}"
                            name="date"
                            value="{{ date }}"
                            min="{{ date_bet.time_period_start|date:"Y-m-d" }}"
                            max="{{ date_bet.time_period_end|date:"Y-m-d" }}"
                        >
                        <label for="{{ forloop.counter }}">{{ date }}</label>
                        <button
                            m-full
                            name="resolve"
                            value="resolve"
                            onclick="return confirm('Are you sure? The bet will be closed and the pot will be distributed.')"
                        >
                            Resolve
                        </button>
                    </form>
                </div>
            </grid>
        {% elif user_can_place_bet and not date_bet.owner == user.profile and not date_bet.winning_date %}
            <h2>Place Bet</h2>
            <form action="{% url 'bets:place_bet' date_bet.prim_key %}" method="post">
                {% csrf_token %}
                <label for="number"><h5>Amount</h5></label>
                <input
                    type="number"
                    id="placed"
                    name="placed"
                    min="0"
                    placeholder="Amount"
                    required
                >
                <label for="date"><h5>Date</h5></label>
                <input
                    type="date"
                    id="placed"
                    name="date"
                    min="{{ date_bet.time_period_start|date:"Y-m-d" }}"
                    max="{{ date_bet.time_period_end|date:"Y-m-d" }}"
                    placeholder="Date"
                    required
                >
                <button m-full type="submit">Bet</button>
            </form>
        {% elif not user_can_place_bet and date_bet.owner == user.profile and not date_bet.winning_date %}
            <h2>Resolve Bet</h2>
            <h5>Winning Date</h5>
            <form action="{% url 'bets:resolve_bet' date_bet.prim_key %}" method="post">
                {% csrf_token %}
                <input
                    type="date"
                    id="{{ forloop.counter }}"
                    name="date"
                    value="{{ date }}"
                    min="{{ date_bet.time_period_start|date:"Y-m-d" }}"
                    max="{{ date_bet.time_period_end|date:"Y-m-d" }}"
                >
                <label for="{{ forloop.counter }}">{{ date }}</label>
                <button
                    m-full
                    name="resolve"
                    value="resolve"
                    onclick="return confirm('Are you sure? The bet will be closed and the pot will be distributed.')"
                >
                    Resolve
                </button>
            </form>
        {% endif %}
    {% endif %}
{% endblock %}
